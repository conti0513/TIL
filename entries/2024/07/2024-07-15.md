以下に、TILで報告するための一連の手順をテキスト化しました。

---

# Today I Learned

## 2024-07-15

### Today's Learnings

---

### プロジェクト構成

```
/workspaces/development_public
├── .github
│   └── workflows
│       └── docker-publish.yml
├── infra_pjt
│   └── python_project
│       ├── Dockerfile
│       ├── app.py
│       └── requirements.txt
├── README.md
├── TIL
├── infra_pjt
├── operation
├── tutorial_PowerShell
├── tutorial_docker
├── tutorial_php
└── tutorial_sh
```

---

### infra_pjtディレクトリに移動

```sh
cd /workspaces/development_public
```

### ディレクトリの作成

```sh
mkdir -p /workspaces/development_public/infra_pjt/python_project
```

### Dockerfileの作成

```sh
echo 'FROM python:3.9-slim
WORKDIR /app
COPY requirements.txt .
RUN pip install --no-cache-dir -r requirements.txt
COPY . .
CMD ["python", "app.py"]' > /workspaces/development_public/infra_pjt/python_project/Dockerfile
```

### Pythonアプリケーションファイルの作成

```sh
echo 'print("Hello, Python!")' > /workspaces/development_public/infra_pjt/python_project/app.py
```

### 空のrequirements.txtファイルの作成

```sh
touch /workspaces/development_public/infra_pjt/python_project/requirements.txt
```

### .github/workflowsディレクトリの作成

```sh
mkdir -p /workspaces/development_public/.github/workflows
```

### docker-publish.ymlの作成

```sh
echo 'name: Build and Push Docker Image

on:
  push:
    branches:
      - main

jobs:
  build-and-push-python:
    runs-on: ubuntu-latest

    steps:
      - name: Checkout repository
        uses: actions/checkout@v2

      - name: Set up Docker Buildx
        uses: docker/setup-buildx-action@v1

      - name: Login to Docker Hub
        uses: docker/login-action@v1
        with:
          username: ${{ secrets.DOCKER_USERNAME }}
          password: ${{ secrets.DOCKER_PASSWORD }}

      - name: Build and push
        uses: docker/build-push-action@v2
        with:
          context: ./infra_pjt/python_project
          push: true
          tags: your-dockerhub-username/python-project:latest' > /workspaces/development_public/.github/workflows/docker-publish.yml
```

### 変更をステージング

```sh
git add .
# サブモジュール内の変更はスルー
git reset TIL
```

### 変更をコミット

```sh
git commit -m "Set up Docker build for Python project"
```

### 変更をプッシュ

```sh
git push origin main
```

---

## 公開リポジトリでのリスク管理手順

### 1. シークレットの設定

1. **GitHubリポジトリに移動**
2. **「Settings」 > 「Secrets and variables」 > 「Actions」 を選択**
3. **「New repository secret」ボタンをクリック**
4. 以下のシークレットを追加：
   - `DOCKER_USERNAME`：Docker Hubのユーザー名
   - `DOCKER_PASSWORD`：Docker Hubのパスワード

### 2. GitHub Actionsワークフローの設定

`.github/workflows/docker-publish.yml`ファイルを作成し、以下の内容を記述：

```yaml
name: Build and Push Docker Image

on:
  push:
    branches:
      - main

jobs:
  build-and-push-python:
    runs-on: ubuntu-latest

    steps:
      - name: Checkout repository
        uses: actions/checkout@v2

      - name: Set up Docker Buildx
        uses: docker/setup-buildx-action@v1

      - name: Login to Docker Hub
        uses: docker/login-action@v1
        with:
          username: ${{ secrets.DOCKER_USERNAME }}
          password: ${{ secrets.DOCKER_PASSWORD }}

      - name: Build and push
        uses: docker/build-push-action@v2
        with:
          context: ./infra_pjt/python_project
          push: true
          tags: your-dockerhub-username/python-project:latest
```

### 3. コードのプッシュ

1. **変更をステージング**

    ```sh
    git add .
    # サブモジュール内の変更はスルー
    git reset TIL
    ```

2. **変更をコミット**

    ```sh
    git commit -m "Set up Docker build for Python project"
    ```

3. **変更をプッシュ**

    ```sh
    git push origin main
    ```

### セキュリティ対策

1. **シークレットの定期的な更新**
   - 定期的にシークレット情報（パスワードやAPIキー）を更新します。

2. **監査ログの確認**
   - GitHubの監査ログ機能を利用して、異常なアクティビティがないか確認します。cd /workspaces/development_public


3. **セキュリティアラートの対応**
   - GitHubのセキュリティアラート機能を活用し、脆弱性が発見された場合に迅速に対応します。

---

### まとめ

これらの手順に従うことで、公開リポジトリでのリスクを最小限に抑え、シークレット情報を安全に管理することができます。

---
以下に、汎用的な文言に修正した内容を記載します。

---

# Today I Learned

## 2024-07-15

### Docker Hubへのイメージのビルドとプッシュ

1. **プロジェクトディレクトリに移動**

    ```sh
    cd /workspaces/development_public/infra_pjt/python_project
    ```

2. **Dockerイメージをビルド**

    ```sh
    docker build -t your-dockerhub-username/python-project:latest .
    ```

3. **Docker Hubにログイン**

    ```sh
    docker login
    ```

    ログインを求められたら、Docker Hubのユーザー名（`your-dockerhub-username`）とパスワードを入力します。

4. **Dockerイメージをプッシュ**

    ```sh
    docker push your-dockerhub-username/python-project:latest
    ```

これで、GitHub CodespacesからDockerイメージをビルドし、Docker Hubの `your-dockerhub-username/python-project` リポジトリにプッシュできます。

---

### ローカル環境でのDockerイメージのダウンロードと実行

ローカルの開発環境を整備するために、以下の手順でDockerイメージをダウンロードし、開発環境を整備します。

1. **Dockerのインストール**

    まず、Dockerがローカルマシンにインストールされていることを確認してください。インストールされていない場合は、以下のリンクからインストール手順に従ってください。

    - [Docker Desktop for Mac](https://docs.docker.com/desktop/mac/install/)

2. **Dockerイメージのダウンロード**

    ```sh
    docker pull your-dockerhub-username/python-project:latest
    ```

3. **Dockerコンテナの実行**

    ```sh
    docker run --rm --platform linux/amd64 your-dockerhub-username/python-project:latest
    ```

これで、ローカル環境でもDockerイメージを使用して開発を進めることができます。

---





以下に手順を修正して記載します。

---

# Today I Learned

## 2024-07-15

### Docker Hubへのイメージのビルドとプッシュ

1. **プロジェクトディレクトリに移動**

    ```sh
    cd /workspaces/development_public
    ```

2. **`app.py` を修正**

    ```sh
    vim /workspaces/development_public/infra_pjt/python_project/app.py
    ```

    Vimで内容を以下のように修正します：

    ```python
    print("Hello, Python and Docker")
    ```

    修正が完了したら、`Esc` キーを押してコマンドモードに戻り、`:wq` と入力してEnterキーを押し、ファイルを保存してVimを終了します。

3. **変更をコミットしてプッシュ**

    ```sh
    git add /workspaces/development_public/infra_pjt/python_project/app.py
    git commit -m "Update hello message in app.py"
    git push origin main
    ```

4. **CICDの確認**

    GitHub Actionsページで、ワークフローがトリガーされ、ビルドとプッシュが成功したか確認します。

    - GitHubリポジトリに移動
    - 「Actions」タブをクリック
    - 最新のワークフロー実行を確認

5. **新しいDockerイメージの確認と実行**

    新しいDockerイメージが正しくプッシュされたか確認するために、再度Dockerイメージをプルして実行します。

    ```sh
    docker pull your-dockerhub-username/python-project:latest
    docker run --rm --platform linux/amd64 your-dockerhub-username/python-project:latest
    ```

    新しいメッセージ "Hello, Python and Docker" が表示されることを確認します。

---

これで、手順を修正しました。作業を再開して、CICDが正常に動作していることを確認してください。何か問題が発生した場合や追加のサポートが必要な場合は、教えてください。

ワークフローの実行が成功していることを確認できました。次に、最新のDockerイメージをプルして、変更が反映されていることを確認します。

### 1. 最新のDockerイメージをプル

```sh
docker pull your-dockerhub-username/python-project:latest
```

### 2. Dockerコンテナの実行

```sh
docker run --rm --platform linux/amd64 your-dockerhub-username/python-project:latest
```

### コマンドの実行例

1. **最新のDockerイメージをプル**

    ```sh
    docker pull butainco/python-project:latest
    ```

2. **Dockerコンテナの実行**

    ```sh
    docker run --rm --platform linux/amd64 butainco/python-project:latest
    ```

これにより、最新の変更が反映されたDockerイメージを実行でき、メッセージ "Hello, Python and Docker" が表示されるはずです。

ワークフローの実行が成功していることを確認できました。次に、最新のDockerイメージをプルして、変更が反映されていることを確認します。

### 1. 最新のDockerイメージをプル

```sh
docker pull your-dockerhub-username/python-project:latest
```

### 2. Dockerコンテナの実行

```sh
docker run --rm --platform linux/amd64 your-dockerhub-username/python-project:latest
```

### コマンドの実行例

1. **最新のDockerイメージをプル**

    ```sh
    docker pull butainco/python-project:latest
    ```

2. **Dockerコンテナの実行**

    ```sh
    docker run --rm --platform linux/amd64 butainco/python-project:latest
    ```

これにより、最新の変更が反映されたDockerイメージを実行でき、メッセージ "Hello, Python and Docker" が表示されるはずです。

